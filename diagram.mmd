flowchart TB
    %% --- NETWORKING ---
    subgraph VPC["VPC"]
        direction TB
        subgraph PublicSubnets["Public Subnets (AZ1 & AZ2)"]
            IGW["Internet Gateway"]
            NATGW["NAT Gateways"]
        end

        subgraph PrivateSubnets["Private Subnets (AZ1 & AZ2)"]
            EKS["Amazon EKS Cluster"]
            NodeGroup1["Node Group 1"]
            NodeGroup2["Node Group 2"]
            Istio["Istio Service Mesh"]
            Helm["Helm Deployed Apps"]

            RDS["RDS PostgreSQL (Multi-AZ)"]
            ElastiCache["ElastiCache Redis Cluster"]
        end

        S3["S3 Buckets (Static Assets + Terraform State)"]
    end

    %% --- SECURITY ---
    IAM["IAM Roles & Policies (Least Privilege)"]
    SG["Security Groups & NACLs"]
    KMS["KMS Keys (RDS, S3, ElastiCache Encryption)"]

    %% --- FLOW ---
    Internet["Internet Users"]
    Internet -->|HTTP/HTTPS| IGW

    IGW --> PublicSubnets
    PublicSubnets -->|NAT| NATGW
    NATGW --> PrivateSubnets

    EKS --> NodeGroup1
    EKS --> NodeGroup2
    EKS --> Istio
    EKS --> Helm

    PrivateSubnets --> RDS
    PrivateSubnets --> ElastiCache
    PrivateSubnets --> S3

    %% --- SECURITY CONNECTIONS ---
    IAM -.-> EKS
    IAM -.-> RDS
    IAM -.-> S3
    IAM -.-> ElastiCac
